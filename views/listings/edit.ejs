<% layout('layouts/boilerplate') -%>
  <link rel="stylesheet" href="/CSS/edit.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <body>
    <div class="Container">
      <div class="form-container">
        <h1>Edit Details</h1>
        <form method="POST" action="/listings/<%=Data._id%>?_method=PUT" class="edit-form"
          enctype="multipart/form-data">
          <label>Title</label>
          <input type="text" name="place[title]" value="<%=Data.title%>" required />

          <label>Description</label>
          <input type="text" name="place[description]" value="<%=Data.description%>" required />

          <label>Image</label>
          <input type="file" name="place[image]" />

          <label>Price (â‚¹)</label>
          <input type="number" name="place[price]" value="<%=Data.price%>" required />

          <label>Location</label>
          <input type="text" id="locationField" name="place[location]" value="<%=Data.location%>" required />

          <label>State</label>
          <input type="text" id="stateField" name="place[state]" value="<%=Data.state%>" required />  
          
          <!-- Room Type -->
          <label>Room Type</label> 
          <select name="place[roomType]" required>
            <option value="">Select Room Type</option>
            <option value="Single" <%= Data.roomType === "Single" ? "selected" : "" %>>Single</option>
            <option value="Double" <%= Data.roomType === "Double" ? "selected" : "" %>>Double</option>
            <option value="Shared" <%= Data.roomType === "Shared" ? "selected" : "" %>>Shared</option>
          </select>

          <!--tenant -->
          <label>Preferred Tenant</label> 
          <select name="place[preferredTenant]" required>
            <option value="">Select Tenant</option>
            <option value="Boys" <%= Data.preferredTenant === "Boys" ? "selected" : "" %>>Boys</option>
            <option value="Girls" <%= Data.preferredTenant === "Girls" ? "selected" : "" %>>Girls</option>
            <option value="Any" <%= Data.preferredTenant === "Any" ? "selected" : "" %>>Any</option>
          </select>

          <!--availability -->
          <label>Availability</label> 
          <select name="place[availabilityStatus]">
            <option value="Available" <%= Data.availabilityStatus === "Available" ? "selected" : "" %>>
              Available
            </option>
            <option value="Booked" <%= Data.availabilityStatus === "Booked" ? "selected" : "" %>>
              Booked
            </option>
          </select>

          <!-- contact-->
          <label>Contact</label> 
          <input
            type="text"
            name="place[contact][phone]"
            value="<%= Data.contact ? Data.contact.phone : '' %>"
            required
          />


          <input type="hidden" id="latField" name="place[lat]"
            value="<%= Data.mapCoordinates ? Data.mapCoordinates.coordinates[1] : '' %>">
          <input type="hidden" id="lonField" name="place[lon]"
            value="<%= Data.mapCoordinates ? Data.mapCoordinates.coordinates[0] : '' %>">




          <div class="ShowMap">
            <button type="button" id="currentLocationBtn">Use My Current Location</button>

            <div id="map" style="height: 400px; margin-top: 10px;"></div>

          </div>
      </div>


      <button type="submit">Update Listing</button>

      </form>
    </div>

    <!-- Inject listing Data -->
    <script>
      const listingData = <%- JSON.stringify({
        id: Data._id,
        lat: Data.mapCoordinates ? Data.mapCoordinates.coordinates[1] : null,
        lon: Data.mapCoordinates ? Data.mapCoordinates.coordinates[0] : null
      }) %>;
    </script>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="/js/editMap.js"></script>
  </body>

























  <!-- MAANA KABHI TUMSE MILNA NAA HUA,
     PAR DURIYON KA BHI KABHI ANDAJA NAA HUA.
     TUM SHAHAR CHHOD GAYE JO HAMARA,
     NAA JAANE KYO AB APNA HI SHAHAR BEGAANA KYO HUA. -->