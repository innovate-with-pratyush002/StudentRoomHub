<% layout('layouts/boilerplate') -%>
<link rel="stylesheet" href="/CSS/detail.css">
<link rel="stylesheet" href="/path/to/starability-growRotate.min.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<div class="detail-container">
    <section class="listing-details-section">
        <h1 class="listing-title"><%= Data.title %></h1>
        
        <div class="cardImg">
            <img src="<%= Data.image.url %>" alt="Listing Image" class="card-img" />
        </div>

        <div class="info-card-container">
            <div class="info-card description-card">
                <p class="card-title">Description:</p>
                <p class="card-value"><%= Data.description %></p>
            </div>

            <div class="info-card">
                <p class="card-title">Price:</p>
                <p class="card-value price-value">&#8377; <%= Data.price.toLocaleString("en-In") %>/month</p>
            </div>

            <div class="info-card">
                <p class="card-title">Location:</p>
                <p class="card-value"><%= Data.location %></p>
            </div>

            <div class="info-card">
                <p class="card-title">State:</p>
                <p class="card-value"><%= Data.state %></p>
            </div>
            
            <div class="info-card owner-card">
                <p class="card-title">Owner:</p>
                <p class="card-value"><%= Data.user.username || Data.user.name %></p>
            </div>
        </div>

        <% if (currentUser && currentUser._id.equals(Data.user._id)) { %>
            <div class="buttons">
                <a href="/listings/<%= Data._id %>/edit" class="btn edit-btn">Edit Listing</a>
                <form method="post" action="/listings/<%= Data._id %>?_method=DELETE" class="delete-form">
                    <button class="btn delete-btn">Delete Listing</button>
                </form>
            </div>
        <% } %>
    </section>

    <hr class="section-divider">

    <div class="map-and-reviews-wrapper">
        <section class="map-section">
            <h2 class="section-heading">Location Map</h2>
            <div id="map" class="map-placeholder">
                <p>Map loading...</p>
            </div>
        </section>

        <section class="reviews-section">
            <h2 class="section-heading">Reviews & Ratings (<%= Data.reviews.length %>)</h2>

            <div class="add-review-box">
                <h3 class="form-heading">Share Your Experience</h3>
                <form action="/listings/<%= Data._id %>/reviews" method="POST" class="review-form" novalidate>
                    <fieldset class="starability-growRotate rating-fieldset">
                        <legend><strong>Rating:</strong></legend>
                        <input type="radio" id="rate1" name="review[rating]" value="1"><label for="rate1" title="Terrible">1 star</label>
                        <input type="radio" id="rate2" name="review[rating]" value="2"><label for="rate2" title="Not good">2 stars</label>
                        <input type="radio" id="rate3" name="review[rating]" value="3" checked><label for="rate3" title="Average">3 stars</label>
                        <input type="radio" id="rate4" name="review[rating]" value="4"><label for="rate4" title="Very good">4 stars</label>
                        <input type="radio" id="rate5" name="review[rating]" value="5"><label for="rate5" title="Amazing">5 stars</label>
                    </fieldset>

                    <div class="comment-group">
                        <label for="comment" class="form-label">Comment</label>
                        <textarea class="form-textarea" name="review[comment]" id="comment" rows="3" placeholder="Write your thoughts..." required></textarea>
                    </div>
                    <button class="btn submit-review-btn">Submit Review</button>
                </form>
            </div>

            <div class="reviews-list">
                <% if (Data.reviews.length === 0) { %>
                    <p class="no-reviews">Be the first to leave a review!</p>
                <% } %>

                <% for (let review of Data.reviews) { %>
                    <div class="review-card">
                        <div class="review-header">
                            <h4 class="reviewer-name"><%= review.owner.username || review.owner.name || "Unknown User" %></h4>
                            <div class="review-rating">
                                <p class="starability-result" data-rating="<%= review.rating %>"></p>
                            </div>
                        </div>
                        <p class="review-comment"><%= review.comment %></p>

                        <% if (currentUser && currentUser._id.equals(review.owner._id)) { %>
                            <form method="POST" action="/listings/<%= Data._id %>/reviews/<%= review._id %>?_method=DELETE" class="delete-review-form">
                                <button class="btn delete-review-btn">Delete</button>
                            </form>
                        <% } %>
                    </div>
                <% } %>
            </div>
        </section>
    </div>
</div>
<!-- Scripts -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="/js/detailListingMap.js"></script>










































  <!-- TERI AANKHO KI JO BAAT HAI, VO LAFZON ME KAHA AATI HAI.
     INME CHHUPE HAIN RAAJ KAYI, JAISE CHAND KI PARCHHAAYI HAI,
     NAZRE JHUKI TO HAYA LAGE, UTHE TO QAYAMAT LAAYI HAI.          -->